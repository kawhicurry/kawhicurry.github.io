<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>分类: Auto | Kawhicurry's Blog</title><meta name="author" content="kawhicurry"><meta name="copyright" content="kawhicurry"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="前言太痛了！ ROS官方推荐的是拿Ubuntu装ros，但是用过arch系的应该都回不去了吧（笑），刚好arch官方也有ROS的文档，ROS也有arch的推荐位，所以，拿我的manjaro装好啦。 官方文档 上面说有aur源，那只要一键安装就好了。 yay -Sy ros-melodic-deskt"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/kawhicurry/picgo/profile/favicon.jpg"><link rel="canonical" href="https://kawhicurry.github.io/Auto/b84eee2e/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="baidu-site-verification" content="code-UXVbU6tNCR"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-70WJTE71NM"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-70WJTE71NM');
</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"prismjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":1000},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: kawhicurry","link":"链接: ","source":"来源: Kawhicurry's Blog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#d8dee9","bgDark":"#2e3440","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '分类: Auto',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-10-22 12:14:45'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Kawhicurry's Blog" type="application/atom+xml">
</head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://cdn.jsdelivr.net/gh/kawhicurry/picgo/profile/avatar.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">79</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">39</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/gh/kawhicurry/picgo/nordic/ign_gunshot.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Kawhicurry's Blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">折磨的ROS-in-arch（manjaro）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-04-19T10:29:18.000Z" title="发表于 2022-04-19 10:29:18">2022-04-19</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-10-22T12:14:45.179Z" title="更新于 2022-10-22 12:14:45">2022-10-22</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Auto/">Auto</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">2.2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>7分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="折磨的ROS-in-arch（manjaro）"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>太痛了！</p>
<p>ROS官方推荐的是拿Ubuntu装ros，但是用过arch系的应该都回不去了吧（笑），刚好arch官方也有ROS的文档，ROS也有arch的推荐位，所以，拿我的manjaro装好啦。</p>
<p><a target="_blank" rel="noopener" href="https://wiki.archlinux.org/title/ROS">官方文档</a></p>
<p>上面说有aur源，那只要一键安装就好了。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yay -Sy ros-melodic-desktop-full<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>然后选一选就完了，好了，这篇文章水完了。</p>
<p>真要这么简单我就不至于写一篇文章来说这个了。记录下安装过程中的各种问题。</p>
<p>首先是ROS的发行版选择，说实话，我个人目前看不出来各个发行版有什么不同，至少不会有ubuntu和centos那样很明显的不同，而Arch提供了两个发行版<code>noetic</code>和<code>melodic</code>，对于ROS2，则只有一个<code>galactic</code>。这里讨论的是ROS1的安装，所以2就忽略了。我上面写的是melodic是因为当初在Ubuntu虚拟机上学ROS的时候就用的它，而且melodic其实也是个蛮好听的单词（狗头）。<strong>然后就出事了</strong>。</p>
<h1 id="坑"><a href="#坑" class="headerlink" title="坑"></a>坑</h1><h2 id="第一个坑，记不清了"><a href="#第一个坑，记不清了" class="headerlink" title="第一个坑，记不清了"></a>第一个坑，记不清了</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">-- found pythoninterp: /usr/bin/python3 <span class="token punctuation">(</span>found suitable version <span class="token string">"3.10.4"</span>, minimum required is <span class="token string">"2"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>后面还有两句，说是找不到python3.9的库，年代久远，找不到记录了。</p>
<p>这时候我尝试了更换python为3.9的版本，但是完全没有用，我也记不得咋解决的，就挺糟糕的。</p>
<p>写到这里的时候我想到要去把终端的输出存成日志，然后就发现了<code>script</code>这个命令，可以把终端的所有输出都存进文件。看样子记不起来的东西也能教会我什么，哈哈哈。</p>
<p>贴上<code>script</code>自动存储输出的代码片段，贴到zsh最下面就能跑了</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -d ~/.local/log <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
        <span class="token function">mkdir</span> -p ~/.local/log
<span class="token keyword">fi</span>
<span class="token comment"># make sure run in login-shell</span>
<span class="token keyword">if</span> <span class="token builtin class-name">test</span> -t <span class="token number">0</span> <span class="token punctuation">;</span><span class="token keyword">then</span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">ps</span> <span class="token environment constant">$PPID</span> <span class="token operator">|</span> <span class="token function">grep</span> -c script <span class="token variable">)</span></span> -eq <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
                <span class="token builtin class-name">local</span> <span class="token assign-left variable">name</span><span class="token operator">=~</span>/.local/log/<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%Y-%M-%d-%H-%M-%S<span class="token punctuation">$(</span>tty <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'s/\//-/g'</span><span class="token punctuation">)</span><span class="token variable">)</span></span>
                script -q -t <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token variable">$name</span>.time -a <span class="token variable">$name</span>.command
                <span class="token builtin class-name">exit</span>
        <span class="token keyword">fi</span>
<span class="token keyword">fi</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="log4cxx的奇怪问题"><a href="#log4cxx的奇怪问题" class="headerlink" title="log4cxx的奇怪问题"></a>log4cxx的奇怪问题</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">/usr/include/log4cxx/boost-std-configuration.h:10:18: error: ‘shared_mutex’ <span class="token keyword">in</span> namespace ‘std’ does not name a <span class="token builtin class-name">type</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>说是log4cxx的问题，官方bug，没有修好，解决方案在aur源评论区里：<a target="_blank" rel="noopener" href="https://bugs.archlinux.org/task/71847">https://bugs.archlinux.org/task/71847</a></p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// change:</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">STD_SHARED_MUTEX_FOUND</span> <span class="token expression"><span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">Boost_SHARED_MUTEX_FOUND</span> <span class="token expression"><span class="token number">0</span></span></span>

<span class="token comment">// to:</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">STD_SHARED_MUTEX_FOUND</span> <span class="token expression"><span class="token number">0</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">Boost_SHARED_MUTEX_FOUND</span> <span class="token expression"><span class="token number">1</span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>然后编译就过了，具体讨论看上面网址。</p>
<h2 id="siq的语法错误"><a href="#siq的语法错误" class="headerlink" title="siq的语法错误"></a>siq的语法错误</h2><p>应该是python sip的版本问题</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">sip: /usr/lib/python3.10/site-packages/pyqt5/bindings/qtcore/qtcoremod.sip:23: syntax error<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>aur源中对pyqt5的依赖为<code>python-pyqt5-sip4</code>，而不是直接的<code>python-pyqt5</code>。也就是之前<code>pip</code>安装过的<code>pyqt5</code>是用不了的。得用pip卸了先，然后让yay去处理依赖。</p>
<p>我在这里搜了一大堆教程，告诉我以后装python包不要用pip，要用yay之类的工具，这对于我这种pip习惯用户来说一开始有点不习惯。不过翻阅了arch的python文档之后，发现官方的要求是，所有pip安装的包都要加上<code>--usre</code>来确保不会与系统安装的包冲突。论看官方wiki的重要性。</p>
<h2 id="无效的python3-add-library"><a href="#无效的python3-add-library" class="headerlink" title="无效的python3_add_library"></a>无效的python3_add_library</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">cmake error at /usr/lib64/cmake/pybind11/pybind11newtools.cmake:207 <span class="token punctuation">(</span>python3_add_library<span class="token punctuation">)</span>:
unknown cmake <span class="token builtin class-name">command</span> <span class="token string">"python3_add_library"</span><span class="token builtin class-name">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>上面写的好像是<code>building pybinding interfaces</code>啥的。这里有个描述上来说非常完美相符的东西，但是没有给解决方案:<a target="_blank" rel="noopener" href="https://github.com/OpenChemistry/avogadrolibs/issues/612">https://github.com/OpenChemistry/avogadrolibs/issues/612</a></p>
<p>然后我在这里卡了很久，因为<code>unknown command</code>的原因是之前需要定义一个什么python::python还是module，不过最后还是定位到正确的cmake文件应该在<code>/usr/lib/python3.10/site-packages/PyQt5/Qt5/lib</code>里面，斯，那为什么找到了<code>/usr/lib64</code>里面的<code>.cmake</code>文件。然后发现是之前手动装过<code>pybind11</code>这个包，这个包导致寻找文件的时候优先到<code>/usr/lib64</code>里去寻找了，所以把这个包删了，先让它去另一个位置里找链接库，然后后面再自动装回来就行了。</p>
<h2 id="gazebo对ffmpeg4的依赖"><a href="#gazebo对ffmpeg4的依赖" class="headerlink" title="gazebo对ffmpeg4的依赖"></a>gazebo对ffmpeg4的依赖</h2><p><a target="_blank" rel="noopener" href="https://github.com/osrf/gazebo/issues/3180">https://github.com/osrf/gazebo/issues/3180</a>和这个描述一致，原因是系统默认使用了ffmpeg5而ROS要用ffmpeg4.4，这个issue下面有人提出了如何短暂使用ffmpeg4.4来保证编译顺利进行，其核心思想是跳过依赖检查，从而使得依赖能被顺利安装</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> pacman -Rd --nodeps ffmpeg <span class="token comment"># (and any other ffmpeg you have installed, like the git version)</span>
<span class="token function">sudo</span> pacman -S ffmpeg4.4
yay -S gazebo
<span class="token function">sudo</span> pacman -S ffmpeg<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="opencv3-opt对ffmpeg4的依赖"><a href="#opencv3-opt对ffmpeg4的依赖" class="headerlink" title="opencv3-opt对ffmpeg4的依赖"></a>opencv3-opt对ffmpeg4的依赖</h2><p>编译melodic的过程中，发现它对一个叫<code>opencv3-opt</code>的老版本库有依赖，而这个库写的依赖是<code>ffmpeg</code>，但实际上需要的却是<code>ffmpege4.4</code>，当时我还没有碰到上面gazebo的那个问题，也没有意识到可以跳过依赖检查，当时索性就删掉了melodic已安装的包，换成了noetic。感觉上来说noetic有些包的依赖似乎却是比melodic处理地更好一些。这个问题的解决方法其实和上面那个是一样的。</p>
<h2 id="编译资源占用过多"><a href="#编译资源占用过多" class="headerlink" title="编译资源占用过多"></a>编译资源占用过多</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">cc: fatal error: killed signal terminated program cc1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>如果你用的中文互联网搜索这个问题，那答案都是告诉你如何建立swap分区加内存。我也加了，但是编译还是通过不了。这个报错的核心是资源占用过多，导致编译所需资源过多时操作系统内核会把编译进场杀掉。一开始我也去看了ulimit之类的资源限制，但是其实已经给的很高了，我这好歹是16线程16G内存的电脑，不至于内存不够用吧。使用<code>free</code>和<code>top</code>监控资源后发现，大部分时间内存占用量根本不到2G。我想起来<code>makepkg</code>会默认使用所有的cpu core去编译文件，查了下<code>/etc/makepkg.conf</code>，发现还真是。我手动给它设置成了8核编译，虽然慢一点，但好歹能确保编译通过了。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#MAKEFLAGS="-j$(($(nproc)+1))"</span>
<span class="token assign-left variable">MAKEFLAGS</span><span class="token operator">=</span><span class="token string">"-j8"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h2 id="python找不到链接符号"><a href="#python找不到链接符号" class="headerlink" title="python找不到链接符号"></a>python找不到链接符号</h2><p>历经千辛万苦加一次完全卸载（使用<code>yay -R $(yay -Qmq | grep ros)</code>+<code>yay -c</code>一次性删除所有ROS相关的包），最后一次安装堪称完美，一次</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yay -S ros-noetic-desktop-full<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>直接成功，跑<code>gazebo</code>好像也没问题</p>
<p>然后一跑<code>rosrun rqt_console rqt_console</code>就发现它报</p>
<pre class="line-numbers language-none"><code class="language-none">python: symbol lookup error: &#x2F;usr&#x2F;lib&#x2F;python3.10&#x2F;site-packages&#x2F;pyqt5&#x2F;qt5&#x2F;plugins&#x2F;platforms&#x2F;..&#x2F;..&#x2F;lib&#x2F;libqt5waylandclient.so.5: undefined symbol: _zdlpvm, version qt_5<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>这个问题当时在melodic也出现过，各种答案告诉我，你丫pyqt5没装对，不能用pip装。但是这回是真的用了yay了。又是一段漫长的折磨后，我突然想到，这玩意是运行时动态链接的，那是不是说明它没有被加载到动态链接库里去。于是我先是尝试写了个<code>/etc/ld.conf.d/qt.conf</code>的文件，然后刷新动态库，情况有一点点变化了，但是这个报错还在（意思就是在这个报错之上又多了点报错）。于是我又上网查，找到了一个添加<code>LD_LIBRARY_PATH</code>的方法，不过我找不到这个想法的来源了，有点难受。最后的解决方法我写在了这里<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/62384480/symbol-lookup-error-after-updating-qt-package/71925946#71925946">https://stackoverflow.com/questions/62384480/symbol-lookup-error-after-updating-qt-package/71925946#71925946</a></p>
<p>核心思想就是把那个地址加入到动态库里</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">LD_LIBRARY_PAH</span><span class="token operator">=</span>/usr/lib/python3.10/site-packages/PyQt5/Qt/lib:<span class="token variable">$LD_LIBRARY_PATH</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>然后我把这行写进了进入ros环境的脚本里（<code>/opt/ros/noetic/setup.sh</code>，注意，不是zsh，虽然zsh对于zsh用户来说也能用），就保证每次都能正常启动了。</p>
<h2 id="一点小小的优化"><a href="#一点小小的优化" class="headerlink" title="一点小小的优化"></a>一点小小的优化</h2><p>进入ros的指令是写死的</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">source</span> /opt/ros/noetic/setup.zsh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>为了进一步简化，我在<code>.zshrc</code>里加了一行</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">alias</span> <span class="token string">'rosnow'</span><span class="token operator">=</span><span class="token string">'source /opt/ros/noetic/setup.zsh'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>这样就方便多啦。</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>如果仔细想想，其实很多官方包的各种冲突还真不是官方的问题，这里面一部分要甩锅给manjaro，一部分是给自己。在配这份环境之前，我一直没有体会到manjaro和原生arch的区别，这下我是体会到了manjaro“为用户做选择”所带来的一些问题，我在这个过程中也一度想把manjaro删掉了换成arch（还好忍住了）。另一部分就是自己没有好好看arch wiki，导致有些冲突问题。除此之外，这次配环境也是在催促我要赶紧把备份系统搞上来，我居然还不敢来一场系统说换就换的旅行（）</p>
<p>反过来，也是学到了点东西，比如动态库的小知识，比如script这个好东西，还有献出了在<code>stackoverflow</code>上的首答。也许所有arch的用户都是这样吧，一边折磨自己，一边享受这份该死的自由。（这句话是不是要写个manjaro用户除外？，但我现在仍然是是manjaro用户，哈哈）</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://kawhicurry.github.io">kawhicurry</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://kawhicurry.github.io/Auto/b84eee2e/">https://kawhicurry.github.io/Auto/b84eee2e/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://kawhicurry.github.io" target="_blank">Kawhicurry's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="addthis_inline_share_toolbox"></div><script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-62037f9d1c65c8d1" async="async"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/Back-end/ace6f1b7/"><img class="prev-cover" src="https://cdn.jsdelivr.net/gh/kawhicurry/picgo/nordic/ign_tokyo.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">用树莓派搭建一个简单的跳板机</div></div></a></div><div class="next-post pull-right"><a href="/Back-end/a113ba1f/"><img class="next-cover" src="https://cdn.jsdelivr.net/gh/kawhicurry/picgo/nordic/ign_zorin.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">APUE（2）</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://cdn.jsdelivr.net/gh/kawhicurry/picgo/profile/avatar.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="avatar"/></div><div class="author-info__name">kawhicurry</div><div class="author-info__description">An student aiming to be an operation engineer.</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">79</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">39</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/kawhicurry"><i class="fab fa-github"></i><span>逛逛博主的github</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/kawhicurry" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:kawhicurry@foxmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://kawhicurry.github.io/atom.xml" target="_blank" title="Rss"><i class="fas fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">我们一天天所度过的所谓日常,可能是接连不断的奇迹</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9D%91"><span class="toc-number">2.</span> <span class="toc-text">坑</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%9D%91%EF%BC%8C%E8%AE%B0%E4%B8%8D%E6%B8%85%E4%BA%86"><span class="toc-number">2.1.</span> <span class="toc-text">第一个坑，记不清了</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#log4cxx%E7%9A%84%E5%A5%87%E6%80%AA%E9%97%AE%E9%A2%98"><span class="toc-number">2.2.</span> <span class="toc-text">log4cxx的奇怪问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#siq%E7%9A%84%E8%AF%AD%E6%B3%95%E9%94%99%E8%AF%AF"><span class="toc-number">2.3.</span> <span class="toc-text">siq的语法错误</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A0%E6%95%88%E7%9A%84python3-add-library"><span class="toc-number">2.4.</span> <span class="toc-text">无效的python3_add_library</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#gazebo%E5%AF%B9ffmpeg4%E7%9A%84%E4%BE%9D%E8%B5%96"><span class="toc-number">2.5.</span> <span class="toc-text">gazebo对ffmpeg4的依赖</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#opencv3-opt%E5%AF%B9ffmpeg4%E7%9A%84%E4%BE%9D%E8%B5%96"><span class="toc-number">2.6.</span> <span class="toc-text">opencv3-opt对ffmpeg4的依赖</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E8%AF%91%E8%B5%84%E6%BA%90%E5%8D%A0%E7%94%A8%E8%BF%87%E5%A4%9A"><span class="toc-number">2.7.</span> <span class="toc-text">编译资源占用过多</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#python%E6%89%BE%E4%B8%8D%E5%88%B0%E9%93%BE%E6%8E%A5%E7%AC%A6%E5%8F%B7"><span class="toc-number">2.8.</span> <span class="toc-text">python找不到链接符号</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E7%82%B9%E5%B0%8F%E5%B0%8F%E7%9A%84%E4%BC%98%E5%8C%96"><span class="toc-number">2.9.</span> <span class="toc-text">一点小小的优化</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">3.</span> <span class="toc-text">总结</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/Daily/41551188/" title="daily-2024-07-07"><img src="https://cdn.jsdelivr.net/gh/kawhicurry/picgo/nordic/opensuse.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="daily-2024-07-07"/></a><div class="content"><a class="title" href="/Daily/41551188/" title="daily-2024-07-07">daily-2024-07-07</a><time datetime="2024-07-07T00:34:01.000Z" title="发表于 2024-07-07 00:34:01">2024-07-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Operation/47a3710b/" title="从tc开始的一次简单的内核网络栈探索"><img src="https://cdn.jsdelivr.net/gh/kawhicurry/picgo/nordic/ign_wave.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="从tc开始的一次简单的内核网络栈探索"/></a><div class="content"><a class="title" href="/Operation/47a3710b/" title="从tc开始的一次简单的内核网络栈探索">从tc开始的一次简单的内核网络栈探索</a><time datetime="2023-10-29T04:30:06.000Z" title="发表于 2023-10-29 04:30:06">2023-10-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Tools/35816fcf/" title="给飞扬哥的博客上传指南"><img src="https://cdn.jsdelivr.net/gh/kawhicurry/picgo/nordic/ign_farFromTomorrow.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="给飞扬哥的博客上传指南"/></a><div class="content"><a class="title" href="/Tools/35816fcf/" title="给飞扬哥的博客上传指南">给飞扬哥的博客上传指南</a><time datetime="2023-01-26T13:27:32.000Z" title="发表于 2023-01-26 13:27:32">2023-01-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Auto/43a7b386/" title="Apollo2D项目回顾"><img src="https://cdn.jsdelivr.net/gh/kawhicurry/picgo/nordic/super-mario.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Apollo2D项目回顾"/></a><div class="content"><a class="title" href="/Auto/43a7b386/" title="Apollo2D项目回顾">Apollo2D项目回顾</a><time datetime="2022-11-28T10:39:12.000Z" title="发表于 2022-11-28 10:39:12">2022-11-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Operation/8f58554d/" title="ESP,GRUB与BTRFS"><img src="https://cdn.jsdelivr.net/gh/kawhicurry/picgo/nordic/prime-number-spiral.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ESP,GRUB与BTRFS"/></a><div class="content"><a class="title" href="/Operation/8f58554d/" title="ESP,GRUB与BTRFS">ESP,GRUB与BTRFS</a><time datetime="2022-10-24T13:07:07.000Z" title="发表于 2022-10-24 13:07:07">2022-10-24</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://cdn.jsdelivr.net/gh/kawhicurry/picgo/nordic/nord_alone_tree.png')"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2024 By kawhicurry</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Welcome to the world of an growing SRE.</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function addGitalkSource () {
  const ele = document.createElement('link')
  ele.rel = 'stylesheet'
  ele.href= 'https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css'
  document.getElementsByTagName('head')[0].appendChild(ele)
}

function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk(Object.assign({
      clientID: '528affc74d9344c23daf',
      clientSecret: '41afe1cad2849c60940bd386fe0bbda659a73a16',
      repo: 'kawhicurry.github.io.comment',
      owner: 'kawhicurry',
      admin: ['kawhicurry'],
      id: '440a2a054b6a8677875cc08edd53085f',
      updateCountCallback: commentCount
    },null))

    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    addGitalkSource()
    getScript('https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.js').then(initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.innerHTML= n
  }
}

if ('Gitalk' === 'Gitalk' || !false) {
  if (false) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>